<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Solicitar Cotización - construmax</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #f7f5f3; font-family: 'Inter', sans-serif; }
        .cotizar-container { max-width: 600px; margin: 60px auto; background: #fff; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.08); padding: 40px 32px; }
        .cotizar-title { font-family: 'Playfair Display', serif; font-size: 2rem; font-weight: 700; color: #FF6B35; margin-bottom: 12px; }
        .cotizar-subtitle { color: #8B8680; margin-bottom: 32px; }
        .form-label { font-weight: 600; color: #2C1810; }
        .btn-cotizar { background: #FF6B35; color: #fff; font-weight: 600; border-radius: 12px; padding: 14px 0; font-size: 1.1rem; }
        .btn-cotizar:hover { background: #e55a2b; }
        .cotizar-result { background: #f5f3f0; border-radius: 12px; padding: 24px; margin-top: 32px; }
        .cotizar-total { font-size: 1.3rem; font-weight: 700; color: #FF6B35; }
        .cotizar-descuento { color: #27AE60; font-weight: 600; }
    </style>
</head>
<body>
    <div class="cotizar-container">
        <h1 class="cotizar-title"><i class="fas fa-calculator me-2"></i>Solicita tu Cotización</h1>
        <p class="cotizar-subtitle">Llena el formulario y recibe una cotización profesional al instante. Si tu compra supera los $5.000.000, obtendrás un descuento especial.</p>
        <form method="post">
            <div class="mb-3">
                <label for="nombre" class="form-label">Nombre</label>
                <input type="text" class="form-control" id="nombre" name="nombre" required>
            </div>
            <div class="mb-3">
                <label for="correo" class="form-label">Correo electrónico</label>
                <input type="email" class="form-control" id="correo" name="correo" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Selecciona los productos y cantidades</label>
                <div class="table-responsive">
                    <table class="table table-bordered align-middle">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Precio (COP)</th>
                                <th>Stock</th>
                                <th>Cantidad</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for producto in productos %}
                        <tr>
                            <td>{{ producto.nombre }}</td>
                            <td>${{ producto.precio|int|comma }}</td>
                            <td>{{ producto.stock }}</td>
                            <td>
                                <input type="number" min="0" max="{{ producto.stock }}" name="cantidad_{{ producto.id }}" class="form-control" value="0">
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <button type="submit" class="btn btn-cotizar w-100"><i class="fas fa-file-invoice-dollar me-2"></i>Generar Cotización</button>
        </form>
        {% if cotizacion %}
        <div class="cotizar-result mt-4">
            <h4>Resumen de Cotización</h4>
            <p><strong>Nombre:</strong> {{ cotizacion.nombre }}</p>
            <p><strong>Correo:</strong> {{ cotizacion.correo }}</p>
            <div class="table-responsive">
                <table class="table table-bordered align-middle">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th>Precio unitario</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for item in cotizacion.productos %}
                        <tr>
                            <td>{{ item.nombre }}</td>
                            <td>{{ item.cantidad }}</td>
                            <td>${{ item.precio|int|comma }}</td>
                            <td>${{ item.subtotal|int|comma }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <th colspan="3">Total estimado</th>
                            <td>${{ cotizacion.total_estimado|int|comma }} COP</td>
                        </tr>
                        <tr>
                            <th colspan="3">Descuento</th>
                            <td class="cotizar-descuento">${{ cotizacion.descuento|int|comma }} COP</td>
                        </tr>
                        <tr>
                            <th colspan="3">Total final</th>
                            <td class="cotizar-total">${{ cotizacion.total_final|int|comma }} COP</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div class="mt-3">
                <a href="{{ url_for('cotizar.descargar_pdf') }}" class="btn btn-outline-success"><i class="fas fa-file-pdf me-2"></i>Descargar PDF</a>
                <a href="{{ url_for('cotizar.enviar_email') }}" class="btn btn-outline-primary ms-2"><i class="fas fa-envelope me-2"></i>Enviar por correo</a>
            </div>
        </div>
        {% endif %}
    </div>
</body>
</html>
