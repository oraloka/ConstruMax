{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
    <h2>Agregar producto</h2>
    <form action="{{ url_for('productos.agregar_producto') }}" method="POST" enctype="multipart/form-data" id="formAgregarProducto">
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="nombre">Nombre</label>
                <input type="text" class="form-control" id="nombre" name="nombre" required>
            </div>
            <div class="form-group col-md-6">
                <label for="categoria">Categoría</label>
                <select class="form-control" id="categoria" name="categoria" required>
                    <option value="">Selecciona una categoría</option>
                    <option value="obra gris">Obra gris</option>
                    <option value="impermeabilizante">Impermeabilizante</option>
                    <option value="pegantes">Pegantes</option>
                    <option value="boquillas">Boquillas</option>
                    {% for cat in categorias %}
                        {% if cat not in ['obra gris', 'impermeabilizante', 'pegantes', 'boquillas'] %}
                            <option value="{{ cat }}">{{ cat }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="precio_compra" class="fw-bold">Precio de compra</label>
                <input type="number" step="0.01" class="form-control" id="precio_compra" name="precio_compra" required>
                <small class="form-text text-muted">Valor que te cobra la empresa externa.</small>
            </div>
            <div class="form-group col-md-4">
                <label for="porcentaje_ganancia" class="fw-bold">% Ganancia</label>
                <input type="number" step="0.01" class="form-control" id="porcentaje_ganancia" name="porcentaje_ganancia" value="20" required>
                <small class="form-text text-muted">Porcentaje de ganancia que deseas obtener.</small>
            </div>
            <div class="form-group col-md-4">
                <label for="iva" class="fw-bold">IVA (%)</label>
                <input type="number" step="0.01" class="form-control" id="iva" name="iva" value="19" required>
                <small class="form-text text-muted">Porcentaje de IVA (por defecto 19%).</small>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="precio">Precio final</label>
                <input type="number" step="0.01" class="form-control" id="precio" name="precio" readonly placeholder="Se calculará automáticamente">
                <small id="precioFinalTexto" class="form-text text-success fw-bold"></small>
            </div>
            <div class="form-group col-md-6">
                <label for="presentacion">Presentación</label>
                <input type="text" class="form-control" id="presentacion" name="presentacion">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="marca">Marca</label>
                <input type="text" class="form-control" id="marca" name="marca">
            </div>
            <div class="form-group col-md-6">
                <label for="descripcion">Descripción</label>
                <textarea class="form-control" id="descripcion" name="descripcion" rows="2" required></textarea>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="stock" class="fw-bold text-success">Stock inicial <i class="fas fa-boxes"></i></label>
                <input type="number" class="form-control border border-success" id="stock" name="stock" min="0" value="0" required>
                <small class="form-text text-success">Indica la cantidad inicial disponible para este producto.</small>
            </div>
        </div>
        <div class="form-group">
            <label for="imagen">Imagen</label>
            <input type="file" class="form-control-file" id="imagen" name="imagen">
        </div>
        <button type="submit" class="btn btn-success">Agregar producto</button>
    </form>
    <script>
    function calcularPrecioFinal() {
        const compra = parseFloat(document.getElementById('precio_compra').value) || 0;
        const ganancia = parseFloat(document.getElementById('porcentaje_ganancia').value) || 0;
        const iva = parseFloat(document.getElementById('iva').value) || 0;
        let precio = compra * (1 + ganancia/100) * (1 + iva/100);
        document.getElementById('precio').value = precio.toFixed(2);
        document.getElementById('precioFinalTexto').textContent = precio > 0 ? `Precio final sugerido: $${precio.toLocaleString('es-CO', {minimumFractionDigits:2})}` : '';
    }
    document.getElementById('precio_compra').addEventListener('input', calcularPrecioFinal);
    document.getElementById('porcentaje_ganancia').addEventListener('input', calcularPrecioFinal);
    document.getElementById('iva').addEventListener('input', calcularPrecioFinal);
    window.addEventListener('DOMContentLoaded', calcularPrecioFinal);
    </script>
    </form>
</div>
{% endblock %}
